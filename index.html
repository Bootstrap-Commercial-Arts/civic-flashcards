<!DOCTYPE html>
<html><head>
    <title>JS learning document</title>
    <link rel="stylesheet" type="text/css" href="https://honest-utilities.netlify.app/honest.css"> 
    <link rel="stylesheet" type="text/css" href="/style.css">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;700">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap">
    <base href="/">
</head>
<body>
    <header id="header">
	  <div id="headergrid">
		<a class="home-nav" href="https://www.fightwithyourmind.org/">
            <img alt="current project" data-src="https://fightwithyourmind.org/wp-content/uploads/2021/04/Asset-6@2x.png" class="nav lazyloaded" src="https://fightwithyourmind.org/wp-content/uploads/2021/04/Asset-6@2x.png">
        </a>
	    <img id="customlogo" alt="logo" title="logo" data-src="https://www.fightwithyourmind.org/wp-content/uploads/2019/10/logo.png" class="header-logo lazyloaded" src="https://www.fightwithyourmind.org/wp-content/uploads/2019/10/logo.png">
		<a class="fighting-nav" href="https://www.fightwithyourmind.org/fighting">
            <img alt="browse content" data-src="https://fightwithyourmind.org/wp-content/uploads/2021/04/Asset-7@2x.png" src="https://fightwithyourmind.org/wp-content/uploads/2021/04/Asset-7@2x.png">
        </a>
	  </div>
        <button id="pop-up-button">How do I use this?</button>
        <h1 id="deck-title">Civic Flashcards</h1>
        <div id="control-bar">
            <div class="filter-sort-wrapper">
                <button id="filter-sort">Filter & Sort</button>
                <form id="filter-sort-dropdown" class="dropdown-content" name="filterSortForm" style="display: none">
                    <div id="two-columns"></div>
                    <input type="hidden" name="type" id="hidden-type">
                    <button id="filter-sort-submit" type="submit">See Results</button>
                </form>
            </div>
            
            <div class="deck-select-wrapper">
                <button id="deck-select-field">Select your decks</button>
                <form id="deck-select-dropdown" class="dropdown-content" name="deckSelectForm"  style="display: none">
                    <div class="dropdown-item checkbox">
                        <input type="checkbox" value="senator" id="senator" name="senator">
                        <label for="senator">U.S. Senators</label>
                    </div>
                    <div class="dropdown-item checkbox">
                        <input type="checkbox" value="representative" id="representative" name="representative">
                        <label for="representative">U.S. Representatives</label>
                    </div>
                    <div class="dropdown-item checkbox">
                        <input type="checkbox" value="supremeCourt" id="supremeCourt" name="supremeCourt">
                        <label for="supremeCourt">Supreme Court Justices</label>
                    </div>
                    <div class="dropdown-item checkbox">
                        <input type="checkbox" value="cabinet" id="cabinet" name="cabinet">
                        <label for="cabinet">Cabinet Secretaries</label>
                    </div>
                </form>
            </div>
            <button type="submit" id="deck-select-button" form="deck-select-dropdown">Deal Cards</button>
        </div>
    </header>
    <main id="main">
        <div id="modal-wrap" style="display: none">
            <div id="modal-content">
                <h3>This is modal content</h3>
            </div>
        </div>
    </main>

        <script type="text/javascript" src="https://honest-utilities.netlify.app/honest.js"></script>
        <script>
            //Calling functions from honest.js
            displayToggle('pop-up-button', 'modal-wrap', {funcStyle: 'modal'});
            modalOnLoad('modal-wrap');
            displayToggle('deck-select-field', 'deck-select-dropdown', {funcStyle: 'easyHide'});
            displayToggle('filter-sort', 'filter-sort-dropdown', {funcStyle: 'easyHide'});

//FORM SUBMIT SCRIPT

            //Set up vars
            let sortFormData;
            let filterFormObject = new Object();
            let filterFormData = '';
            let filterArray = [];
            let typeArray = [];
            let typeData;
            let newQueryString;

            //Deck Select form
            const formD = document.forms.deckSelectForm;
            function deckSelectSubmit(event) {
                event.preventDefault();
                const formData = new FormData(deckSelectForm);
                for(var pair of formData.entries()) {
                    typeArray.push(`"${pair[0]}"`);
                };
                typeData = typeArray.join('+');
                window.location.href=`${location.origin}?type=${typeData}&popup=no`;
            };

            formD.addEventListener('submit', deckSelectSubmit);

            //Sort & Filter form
            const formFS = document.forms.filterSortForm;
            function filterSortSubmit(event) {
                //capture form data
                event.preventDefault();
                const formData = new FormData(filterSortForm);
                for(var pair of formData.entries()) {
                    if(pair[1] != '') {
                        if(pair[0] === 'sort') {
                            sortFormData = `sort=${pair[1]}`;
                        }
                        else if(pair[0] === 'type') {
                            typeData = `type=${pair[1]}`.replaceAll('" "', '"+"');
                        }
                        else {
                            if(!(filterFormObject[pair[0]])) {
                                filterFormObject[pair[0]] = [];
                            };
                            filterFormObject[pair[0]].push(pair[1]);
                        };
                    };
                };
                // mutate filterFormObject into readable format and save as filterFormData
                
                const loopNestedObj = (obj) => {
                    Object.keys(obj).forEach(key => {
                        if (typeof obj[key] === 'object') {
                            let valueString = obj[key].join('" || "');
                            filterArray.push(`(${key} == "${valueString}")`);
                        };
                    });
                    let encodedFilterData = encodeURI(filterArray.join(' && '));
                    filterFormData = `filter=${encodedFilterData}`;
                };

                loopNestedObj(filterFormObject);

                //create new URL params
                console.log(`SORT: ${sortFormData} | FILTER: ${filterFormData} | TYPE: ${typeData}`);
                if(sortFormData && !(filterFormData)) {
                    console.log('sort only');
                    newQueryString = `${typeData}&${sortFormData}`;
                } else if (!(sortFormData) && filterFormData) {
                    console.log('filter only');
                    newQueryString = `${typeData}&${filterFormData}`;
                } else if (sortFormData && filterFormData) {
                    console.log('filter & sort');
                    newQueryString = `${typeData}&${filterFormData}&${sortFormData}`;
                } else {
                    return {
                        error: true,
                        message: 'Parameter needed'
                    }
                }

    
            // HERE IS HOW YOU LOAD THE URL WITH NEW PARAMS:
             window.location.href=`${location.origin}?${newQueryString}&popup=no`;
            };

            formFS.addEventListener('submit', filterSortSubmit);



// SORT & FILTER DATA MATCHING SCRIPT

            //Set up layout vars for filter & sort menu
            var twoColumns = document.getElementById("two-columns");

            //potential sort/filter fields
            var potentialSort = [{data:'name+asc', label:'Name (a-z)'}, {data:'name+desc', label:'Name (z-a)'}, {data:'memberSince', label:'Member Since'}, {data:'party', label:'Party'}, {data:'state', label:'State'}];
            var potentialFilter = [{name:'nominatedBy', label:'Nominated By', display:'checkbox'},
                                 {name:'memberSince', label:'Member Since', display:'minMax'},
                                 {name:'segalCoverScore', label:'Segal Cover Score', display:'minMax'},
                                 {name:'position', label:'Position', display:'checkbox'}
                                ];

            //go over data & match potential sort/filter fields with found fields
            var sortFilterMatching = function(result){
                //console.log(result.name)
            }

            //fake found data for testing:
            var matchedSort = [{data:'name+asc', label:'Name (a-z)'}, {data:'name+desc', label:'Name (z-a)'}, {data:'memberSince', label:'Member Since'}, {data:'party', label:'Party'}, {data:'state', label:'State'}];
            var matchedFilter = [{name:'nominatedBy', label:'Nominated By', matchedData:['George W. Bush', 'Barack Obama'], display:'checkbox'},
                                 {name:'memberSince', label:'Member Since', matchedData:[2005, 2009, 2006, 2010, 1991, 2020, 2017, 1994, 2018], display:'minMax'},
                                 {name:'segalCoverScore', label:'Segal Cover Score', matchedData:[7, 10, 25, 50, 75, 78], display:'minMax'},
                                 {name:'position', label:'Position', matchedData:['Associate Justice', 'Chief Justice'], display:'checkbox'}
                                ];

//Filter menu item creation
            var createFilterMenu = function(){

                //Filter Wrap
                var filterWrap = document.createElement("div");
                filterWrap.setAttribute("id", "filter-wrap")

                //Filter title
                var filterTitle = document.createElement("h3");
                filterTitle.innerHTML = 'Filter';
                filterWrap.append(filterTitle);

                //Dropdown group
                matchedFilter.forEach(entry => {
                    var dropdownGroup = document.createElement("div");
                    dropdownGroup.setAttribute("class", "dropdown-group");
                    filterWrap.append(dropdownGroup);

                        //Group title
                        var dropdownGroupTitle = document.createElement("h4");
                        dropdownGroupTitle.innerHTML = entry.label;
                        dropdownGroup.append(dropdownGroupTitle);

                        //Group items
                        var dropdownGroupItems = document.createElement("div");
                        dropdownGroupItems.setAttribute("class", "dropdown-group-items");
                        dropdownGroup.append(dropdownGroupItems);

                            //individual items according to field type
                                if(entry.display === 'checkbox'){
                                    Object.values(entry.matchedData).forEach(function(singleEntry){  
                                        //create item
                                        var dropdownItem = document.createElement("div");
                                        dropdownItem.setAttribute("class", "dropdown-item checkbox");
                                        dropdownGroupItems.append(dropdownItem);
                                        //create input
                                        var input = document.createElement("input");
                                        input.setAttribute("type", "checkbox");
                                        input.setAttribute("value", singleEntry);
                                        input.setAttribute("id", singleEntry);
                                        input.setAttribute("name", entry.name);
                                        dropdownItem.append(input);
                                        //create label
                                        var label = document.createElement("label");
                                        label.setAttribute("for", singleEntry);
                                        label.innerHTML = singleEntry;
                                        dropdownItem.append(label)
                                    });
                                } else if(entry.display === 'minMax'){
                                    //create item
                                    var dropdownItem = document.createElement("div");
                                    dropdownItem.setAttribute("class", "dropdown-item min-max");
                                    dropdownGroupItems.append(dropdownItem);
                                    //create min input
                                    var minInput = document.createElement("input");
                                    minInput.setAttribute("type", "number");
                                    minInput.setAttribute("name", `${entry.name}Min`);
                                    dropdownItem.append(minInput);
                                    //create 'to' span
                                    var to = document.createElement("span");
                                    to.innerHTML = 'to';
                                    dropdownItem.append(to);
                                    //create max input
                                    var maxInput = document.createElement("input");
                                    maxInput.setAttribute("type", "number");
                                    maxInput.setAttribute("name", `${entry.name}Max`);
                                    dropdownItem.append(maxInput);
                                } else if(entry.display === 'range'){
                                    let rangeMax = Math.max.apply(null, entry.matchedData);
                                    let rangeMin = Math.min.apply(null, entry.matchedData);
                                    //create item
                                    var dropdownItem = document.createElement("div");
                                    dropdownItem.setAttribute("class", "dropdown-item range");
                                    dropdownGroupItems.append(dropdownItem);
                                    //create min label
                                    var minLabel = document.createElement("span");
                                    minLabel.innerHTML = rangeMin;
                                    dropdownItem.append(minLabel);
                                    //create input
                                    var input = document.createElement("input");
                                    input.setAttribute("type", "range");
                                    input.setAttribute("value", entry.name);
                                    input.setAttribute("name", entry.name)
                                    dropdownItem.append(input);
                                    //create max label
                                    var maxLabel = document.createElement("span");
                                    maxLabel.innerHTML = rangeMax;
                                    dropdownItem.append(maxLabel);
                                };
                            
                });
                //assign hidden 'type' input
                let typeInput = document.getElementById("hidden-type");
                typeInput.setAttribute("value", params.type)

                twoColumns.prepend(filterWrap);
            };

//Sort menu item creation
            var createSortMenu = function(resultFields){

                //Sort Wrap
                var sortWrap = document.createElement("div");
                sortWrap.setAttribute("id", "sort-wrap")


                //Sort title
                var sortTitle = document.createElement("h3");
                sortTitle.innerHTML = 'Sort';
                sortWrap.append(sortTitle);

                //Dropdown group
                matchedSort.forEach(entry => {
                    var dropdownItem = document.createElement("div");
                    dropdownItem.setAttribute("class", "dropdown-item radio");
                    sortWrap.append(dropdownItem);
                    
                    //create input
                    var input = document.createElement("input");
                    input.setAttribute("type", "radio");
                    input.setAttribute("value", entry.data);
                    input.setAttribute("id", entry.data);
                    input.setAttribute("name", "sort");
                    dropdownItem.append(input);
                    
                    //create label
                    var label = document.createElement("label");
                    label.setAttribute("for", entry.data);
                    label.innerHTML = entry.label;
                    dropdownItem.append(label)
                });
                
                twoColumns.append(sortWrap);
            };

            
// CARD CREATION SCRIPT

            //Set up layout vars for card creation
            var main = document.getElementById("main");
            var cardGrid = document.createElement("div");
            cardGrid.setAttribute("class", "grid-row");
            cardGrid.setAttribute("id", "card-grid");

            //Individual card structure creation
            var createCard = function(result){
                
                //Card div 
                var card = document.createElement("div");
                card.setAttribute("class", "card");
                
                    //Card-inner div 
                    var cardInner = document.createElement("div");
                    cardInner.setAttribute("class", "card-inner");
                    card.append(cardInner);

                        //Card-front div 
                        var cardFront = document.createElement("div");
                        cardFront.setAttribute("class", "card-front");
                        cardInner.append(cardFront);

                            //Card-front image, including extracting image ID
                            var cardImage = document.createElement("img");
                            var imageRef = result.cardBackImage.asset._ref;
                            var imageID = imageRef.replace('image-','').replace('-jpg','');
                            cardImage.src = `https://cdn.sanity.io/images/6dyl9k59/production/${imageID}.jpg`
                            cardFront.append(cardImage);

                        //Card-back div 
                        var cardBack = document.createElement("div");
                        cardBack.setAttribute("class", "card-back");
                        cardInner.append(cardBack);

                        if(result._type === "senator"){
                            //Card-header div 
                            var cardHeader = document.createElement("div");
                            cardHeader.setAttribute("class", "card-header");
                            cardBack.append(cardHeader);

                                //Name
                                var name = document.createElement("h1");
                                name.innerHTML = result.name;
                                cardHeader.append(name);

                                //Party & State
                                var partyAndState = document.createElement("h2");
                                var partyInitial = result.party.partyName.slice(0,1);
                                partyAndState.innerHTML = `(${partyInitial}) ${result.state.stateAbbr}`;
                                cardHeader.append(partyAndState);

                            //Card-body div
                            var cardBody = document.createElement("div");
                            cardBody.setAttribute("class", "card-body");
                            cardBack.append(cardBody);

                                //Leadership-positions
                                var leadershipPositions = document.createElement("div");
                                leadershipPositions.setAttribute("class", "leadership-positions");
                                cardBody.append(leadershipPositions);

                                    //Leadership positions label
                                    var leadershipPositionsLabel = document.createElement("h3");
                                    leadershipPositionsLabel.innerHTML = "Leadership Positions"
                                    leadershipPositions.append(leadershipPositionsLabel);

                                    //Leadership positions content
                                    var leadershipPositionsContent = document.createElement("p");
                                    if (result.leadershipPositions) {
                                        stringifyPositions = result.leadershipPositions.join(', ');
                                    } else {
                                        stringifyPositions = 'none';
                                    }
                                    leadershipPositionsContent.innerHTML = stringifyPositions;
                                    leadershipPositions.append(leadershipPositionsContent);

                                //Committee-assignments
                                var committeeAssignments = document.createElement("div");
                                committeeAssignments.setAttribute("class", "committee-assignments");
                                cardBody.append(committeeAssignments);

                                    //Leadership positions label
                                    var committeeAssignmentsLabel = document.createElement("h3");
                                    committeeAssignmentsLabel.innerHTML = "Committee Assignments"
                                    committeeAssignments.append(committeeAssignmentsLabel);

                                    //Leadership positions content
                                    var committeeAssignmentsContent = document.createElement("p");
                                    if (result.committeeAssignments) {
                                        stringifyPositions = result.committeeAssignments.join(', ');
                                    } else {
                                        stringifyPositions = 'none';
                                    }
                                    committeeAssignmentsContent.innerHTML = stringifyPositions;
                                    committeeAssignments.append(committeeAssignmentsContent);

                                //Assumed-office
                                var assumedOffice = document.createElement("div");
                                assumedOffice.setAttribute("class", "assumed-office");
                                cardBody.append(assumedOffice);

                                    //Assumed office label
                                    var assumedOfficeLabel = document.createElement("h3");
                                    assumedOfficeLabel.innerHTML = "Assumed Office"
                                    assumedOffice.append(assumedOfficeLabel);

                                    //Assumed office content
                                    var assumedOfficeContent = document.createElement("p");
                                    assumedOfficeContent.innerHTML = result.assumedOffice;
                                    assumedOffice.append(assumedOfficeContent);

                                //Reelection-year
                                var reelectionYear = document.createElement("div");
                                reelectionYear.setAttribute("class", "reelection-year");
                                cardBody.append(reelectionYear);

                                    //Reelection year label
                                    var reelectionYearLabel = document.createElement("h3");
                                    reelectionYearLabel.innerHTML = "Reelection Year"
                                    reelectionYear.append(reelectionYearLabel);

                                    //Reelection year content
                                    var reelectionYearContent = document.createElement("p");
                                    reelectionYearContent.innerHTML = result.reelectionYear;
                                    reelectionYear.append(reelectionYearContent);

                            //Card Link (button)
                            var cardButton = document.createElement("a");
                            cardButton.setAttribute("class", "card-button");
                            cardButton.innerHTML = "Visit Senate.gov Website";
                            cardButton.href = result.cardLink;
                            cardButton.target = "_blank";
                            cardBack.append(cardButton);
                        } 
                        else if(result._type === "supremeCourt"){
                            //Card-header div 
                            var cardHeader = document.createElement("div");
                            cardHeader.setAttribute("class", "card-header");
                            cardBack.append(cardHeader);

                                //Name
                                var name = document.createElement("h1");
                                name.innerHTML = result.name;
                                cardHeader.append(name);

                                //Position
                                var position = document.createElement("h2");
                                position.innerHTML = result.position;
                                cardHeader.append(position);

                            //Card-body div
                            var cardBody = document.createElement("div");
                            cardBody.setAttribute("class", "card-body");
                            cardBack.append(cardBody);

                                //Nominated-by
                                var nominatedBy = document.createElement("div");
                                nominatedBy.setAttribute("class", "nominated-by");
                                cardBody.append(nominatedBy);

                                    //Nominated by label
                                    var nominatedByLabel = document.createElement("h3");
                                    nominatedByLabel.innerHTML = "Nominated By"
                                    nominatedBy.append(nominatedByLabel);

                                    //Nominated by content
                                    var nominatedByContent = document.createElement("p");
                                    nominatedByContent.innerHTML = result.nominatedBy;
                                    nominatedBy.append(nominatedByContent);

                                //Member-since
                                var memberSince = document.createElement("div");
                                memberSince.setAttribute("class", "member-since");
                                cardBody.append(memberSince);

                                    //Leadership positions label
                                    var memberSinceLabel = document.createElement("h3");
                                    memberSinceLabel.innerHTML = "Justice Since"
                                    memberSince.append(memberSinceLabel);

                                    //Leadership positions content
                                    var memberSinceContent = document.createElement("p");
                                    memberSinceContent.innerHTML = result.memberSince;
                                    memberSince.append(memberSinceContent);

                                //Circuit-assignments
                                var circuitAssignments = document.createElement("div");
                                circuitAssignments.setAttribute("class", "circuit-assignments");
                                cardBody.append(circuitAssignments);

                                    //Circuit Assignments label
                                    var circuitAssignmentsLabel = document.createElement("h3");
                                    circuitAssignmentsLabel.innerHTML = "Circuit Assignments"
                                    circuitAssignments.append(circuitAssignmentsLabel);

                                    //Circuit Assignments content
                                    var circuitAssignmentsContent = document.createElement("p");
                                    stringifyPositions = result.circuitAssignments.join(', ');
                                    circuitAssignmentsContent.innerHTML = stringifyPositions;
                                    circuitAssignments.append(circuitAssignmentsContent);

                                //Segal-Cover score
                                var segalCoverScore = document.createElement("div");
                                segalCoverScore.setAttribute("class", "segal-cover");
                                cardBody.append(segalCoverScore);

                                    //Segal-Cover score label
                                    var segalCoverScoreLabel = document.createElement("h3");
                                    segalCoverScoreLabel.innerHTML = "Segal-Cover Ideology Score"
                                    segalCoverScore.append(segalCoverScoreLabel);

                                    //Segal-Cover score question mark button
                                    var segalCoverScoreQuestion = document.createElement("a");
                                    segalCoverScoreQuestion.setAttribute("class", "segal-cover-question");
                                    segalCoverScoreQuestion.innerHTML = "?";
                                    segalCoverScoreQuestion.href = "https://en.wikipedia.org/wiki/Segal%E2%80%93Cover_score";
                                    segalCoverScoreQuestion.target = "_blank";
                                    segalCoverScore.append(segalCoverScoreQuestion);

                                    //Segal-Cover score content
                                    var segalCoverBar = document.createElement("div");
                                    segalCoverBar.setAttribute("class", "segal-cover-bar");
                                    segalCoverScore.append(segalCoverBar);

                                    var segalCoverScoreNumberWrap = document.createElement("div");
                                    segalCoverScoreNumberWrap.setAttribute("class", "segal-cover-number-wrap");
                                    segalCoverScore.append(segalCoverScoreNumberWrap);

                                    var cleanedScore = Math.trunc(result.segalCoverScore * 100);
                                    
                                    var segalCoverScoreNumber = document.createElement("p");
                                    segalCoverScoreNumber.innerHTML = cleanedScore;
                                    segalCoverScoreNumberWrap.append(segalCoverScoreNumber);

                                    if(cleanedScore >= 90){
                                        segalCoverScoreNumberWrap.setAttribute("style", `margin-left: calc(${cleanedScore}% - 1.5rem)`);
                                        segalCoverBar.setAttribute("style", `background: linear-gradient(90deg, #E39600 calc(${cleanedScore}% - .5rem), #e6e6e6 calc(${cleanedScore}% - 1.5rem));`);
                                    } else if(cleanedScore <=20 ){
                                        segalCoverScoreNumberWrap.setAttribute("style", `margin-left: ${cleanedScore}%`);
                                        segalCoverBar.setAttribute("style", `background: linear-gradient(90deg, #E39600 calc(${cleanedScore}% + .5rem), #e6e6e6 calc(${cleanedScore}% - 1.5rem));`);
                                    } else {
                                        segalCoverScoreNumberWrap.setAttribute("style", `margin-left: calc(${cleanedScore}% - .75rem)`);
                                        segalCoverBar.setAttribute("style", `background: linear-gradient(90deg, #E39600 calc(${cleanedScore}% - .25rem), #e6e6e6 calc(${cleanedScore}% - 1.5rem));`);
                                    }

                                    var segalCoverBottomLabels = document.createElement("p");
                                    segalCoverBottomLabels.setAttribute("class", "segal-cover-bottom-labels");
                                    segalCoverBottomLabels.innerHTML = '<span class="segal-cover-conservative">Conservative</span><span class="segal-cover-center">|</span><span class="segal-cover-liberal">Liberal</span>';
                                    segalCoverScore.append(segalCoverBottomLabels);

                            //Card Link (button)
                            var cardButton = document.createElement("a");
                            cardButton.setAttribute("class", "card-button");
                            cardButton.innerHTML = "Visit Wikipedia Page";
                            cardButton.href = result.cardLink;
                            cardButton.target = "_blank";
                            cardBack.append(cardButton);
                        } 
                        else  if(result._type === "representative"){
                            //Card-header div 
                            var cardHeader = document.createElement("div");
                            cardHeader.setAttribute("class", "card-header");
                            cardBack.append(cardHeader);

                                //Name
                                var name = document.createElement("h1");
                                name.innerHTML = result.name;
                                cardHeader.append(name);

                                //Party & State & District
                                var partyStateDistrict = document.createElement("h2");
                                var partyInitial = result.party.partyName.slice(0,1);
                                partyStateDistrict.innerHTML = `(${partyInitial}) ${result.state.stateAbbr}-${result.district}`;
                                cardHeader.append(partyStateDistrict);

                            //Card-body div
                            var cardBody = document.createElement("div");
                            cardBody.setAttribute("class", "card-body");
                            cardBack.append(cardBody);

                                //Leadership-positions
                                var leadershipPositions = document.createElement("div");
                                leadershipPositions.setAttribute("class", "leadership-positions");
                                cardBody.append(leadershipPositions);

                                    //Leadership positions label
                                    var leadershipPositionsLabel = document.createElement("h3");
                                    leadershipPositionsLabel.innerHTML = "Leadership Positions"
                                    leadershipPositions.append(leadershipPositionsLabel);

                                    //Leadership positions content
                                    var leadershipPositionsContent = document.createElement("p");
                                    if (result.leadershipPositions) {
                                        stringifyPositions = result.leadershipPositions.join(', ');
                                    } else {
                                        stringifyPositions = 'none';
                                    }
                                    leadershipPositionsContent.innerHTML = stringifyPositions;
                                    leadershipPositions.append(leadershipPositionsContent);

                                //Committee-assignments
                                var committeeAssignments = document.createElement("div");
                                committeeAssignments.setAttribute("class", "committee-assignments");
                                cardBody.append(committeeAssignments);

                                    //Leadership positions label
                                    var committeeAssignmentsLabel = document.createElement("h3");
                                    committeeAssignmentsLabel.innerHTML = "Committee Assignments"
                                    committeeAssignments.append(committeeAssignmentsLabel);

                                    //Leadership positions content
                                    var committeeAssignmentsContent = document.createElement("p");
                                    if (result.committeeAssignments) {
                                        stringifyPositions = result.committeeAssignments.join(', ');
                                    } else {
                                        stringifyPositions = 'none';
                                    }
                                    committeeAssignmentsContent.innerHTML = stringifyPositions;
                                    committeeAssignments.append(committeeAssignmentsContent);

                                //Assumed-office
                                var assumedOffice = document.createElement("div");
                                assumedOffice.setAttribute("class", "assumed-office");
                                cardBody.append(assumedOffice);

                                    //Assumed office label
                                    var assumedOfficeLabel = document.createElement("h3");
                                    assumedOfficeLabel.innerHTML = "Assumed Office"
                                    assumedOffice.append(assumedOfficeLabel);

                                    //Assumed office content
                                    var assumedOfficeContent = document.createElement("p");
                                    assumedOfficeContent.innerHTML = result.assumedOffice;
                                    assumedOffice.append(assumedOfficeContent);

                            //Card Link (button)
                            var cardButton = document.createElement("a");
                            cardButton.setAttribute("class", "card-button");
                            cardButton.innerHTML = "Visit Wikipedia Page";
                            cardButton.href = result.cardLink;
                            cardButton.target = "_blank";
                            cardBack.append(cardButton);
                        } 
                        else  if(result._type === "cabinet"){
                            //Card-header div 
                            var cardHeader = document.createElement("div");
                            cardHeader.setAttribute("class", "card-header");
                            cardBack.append(cardHeader);

                                //Name
                                var name = document.createElement("h1");
                                name.innerHTML = result.name;
                                cardHeader.append(name);

                                //Position
                                var position = document.createElement("h2");
                                position.innerHTML = result.position;
                                cardHeader.append(position);

                            //Card-body div
                            var cardBody = document.createElement("div");
                            cardBody.setAttribute("class", "card-body");
                            cardBack.append(cardBody);

                                //Order of Succession
                                var succession = document.createElement("div");
                                succession.setAttribute("class", "order-of-succession");
                                cardBody.append(succession);

                                    //Order of Succession label
                                    var successionLabel = document.createElement("h3");
                                    successionLabel.innerHTML = "Order of Succession"
                                    succession.append(successionLabel);

                                    //Order of Succession content
                                    var successionContent = document.createElement("p");
                                    successionContent.innerHTML = result.succession;
                                    succession.append(successionContent);

                                //Confirmation Committee
                                var confirmationCommittee = document.createElement("div");
                                confirmationCommittee.setAttribute("class", "circuit-assignments");
                                cardBody.append(confirmationCommittee);

                                    //Confirmation Committee label
                                    var confirmationCommitteeLabel = document.createElement("h3");
                                    confirmationCommitteeLabel.innerHTML = "Confirmation Committee"
                                    confirmationCommittee.append(confirmationCommitteeLabel);

                                    //Confirmation Committee content
                                    var confirmationCommitteeContent = document.createElement("p");
                                    stringifyPositions = result.confirmationCommittee.join(', ');
                                    confirmationCommitteeContent.innerHTML = stringifyPositions;
                                    confirmationCommittee.append(confirmationCommitteeContent);


                            //Card Link (button)
                            var cardButton = document.createElement("a");
                            cardButton.setAttribute("class", "card-button");
                            cardButton.innerHTML = "Visit Wikipedia Page";
                            cardButton.href = result.cardLink;
                            cardButton.target = "_blank";
                            cardBack.append(cardButton);

                            //Card Link2 (button)
                            var cardButton2 = document.createElement("a");
                            cardButton2.setAttribute("class", "card-button button2");
                            cardButton2.innerHTML = "Visit Department Website";
                            cardButton2.href = result.cardLink2;
                            cardButton2.target = "_blank";
                            cardBack.append(cardButton2);
                        }
                return card;
            };

// FETCH QUERY SCRIPT
        if(params.type) {
            //Set up query vars
            const projectId = '6dyl9k59';
            const apiDate = 'v2022-01-01';
            const dataSet = 'production';
            const encodedProjection = encodeURIComponent(`_type == 'cabinet' => {_type, name, 'confirmationCommittee': confirmationCommittee[]->.senateCommitteeName, position, succession, cardLink, cardLink2, cardBackImage}, _type == 'representative' => {_type, name, state->, party->, district, assumedOffice, 'leadershipPositions': leadershipPositions[]->.houseLeadershipName, 'committeeAssignments': committeeAssignments[]->.CommitteeName, cardLink, cardBackImage}, _type == 'supremeCourt' => {_type, circuitAssignments[], name, memberSince, nominatedBy, position, segalCoverScore, cardLink, cardBackImage}, _type == 'senator' => {_type, name, party->, state->, leadershipPositions[], 'committeeAssignments': committeeAssignments[]->.senateCommitteeName, reelectionYear, cardLink, assumedOffice, cardBackImage}`);
            const type = params.type.replaceAll(' ', ', ');
            const decodedFilter = decodeURI(params.filter);
            const filter = decodedFilter.replaceAll('_', ' == ');
            let leftFilter;
            let rightFilter;
            let encodedFilter;
              
            //check for filter parameters
            function createFilter(){
                if(params.filter) {
                    leftFilter = `[_type in [${type}] && (${filter})]`;
                } else {
                    leftFilter = `[_type in [${type}]]`;
                }
                return leftFilter;
            };

            createFilter();

            //check for sorting parameters, then create encoded filter
            function createSort() {
                if(params.sort) {
                    const sort = params.sort.replaceAll('_', ' ')
                     rightFilter = `order(${sort})`;
                     encodedFilter = encodeURIComponent(`${leftFilter} | ${rightFilter}`);
                } else {
                     encodedFilter = encodeURIComponent(leftFilter);
                }
                return encodedFilter;
            }

            createSort();

            //fetch data & call the createCard function
            
            fetch(`https://${projectId}.api.sanity.io/${apiDate}/data/query/${dataSet}?query=*${encodedFilter}{${encodedProjection}}`)
            .then(res => res.json())
            .then(cardData => cardData.result.forEach((item)=>{
                cardGrid.append(createCard(item));
                sortFilterMatching(item);
            }),
            main.append(cardGrid));
            
            //call filter & sort menu creation functions
            createFilterMenu();
            createSortMenu();
        };
        </script>
    </body>
</html>
